---
title: "5.8. 重试数据包的完整性"
anchor: "5.8_Retry_Packet_Integrity"
weight: 580
rank: "h2"
---

重试数据包（详见《[QUIC传输](../RFC9000_Chinese_Translation)》的[第17.2.5章](../RFC9000_Chinese_Translation/#17.2.5_Retry_Packet)）携带着重试完整性标签，该标签具有两项属性：它使得被网络意外破坏的数据包可以被丢弃，同时只有观测到初始数据包的实体才能发送合法的重试数据包。

重试完整性标签是一个长度为128位的字段，它是将以下参数作为`AEAD_AES_128_GCM`（详见《[AEAD](https://www.rfc-editor.org/info/rfc5116)》）的输入而计算出的结果。

* 密钥，K，是一个长度为128位的固定值`0xbe0c690b9f66575a1d766b54e368c84e`。

* 随机数，N，是一个长度为96位的固定值`0x461599d35d632bf2239825bb`。

* 明文，P，为空。

* 关联数据，A，是重试伪数据包的内容，如[图8](#Figure_8_Retry_Pseudo-Packet)所示。

密钥和随机数的值是通过对值为`0xd9c9943e6101fd200021506bcc02814c73030f25c79d71ce876eca876e6fca8e`的秘密值和值分别为`quic key`与`quic iv`的标签调用`HKDF-Expand-Label`而衍生出来的（详见[第5.1章](#5.1_Packet_Protection_Keys)）。

{{% block_ref
indx="Figure_8_Retry_Pseudo-Packet"
title="图8：重试伪数据包" %}}

```
重试伪数据包 {
  原始目标连接ID长度 (8),
  原始目标连接ID (0..160),
  包头形式 (1) = 1,
  固定比特位 (1) = 1,
  长数据包类型 (2) = 3,
  未使用 (4),
  版本 (32),
  目标连接ID长度 (8),
  目标连接ID (0..160),
  源连接ID长度 (8),
  源连接ID (0..160),
  重试令牌 (..),
}
```

{{% /block_ref %}}

重试伪数据包不会被实际发送。它是通过对被实际发送的重试数据包移除重试完整性标签，再追加以下两个字段的方式来构建出来的：

原始目标连接ID长度（ODCID Length）：

:   原始目标连接ID长度字段中包含了跟在它后方的原始目标连接ID字段以字节为单位的长度，它被编码为一个8位无符号整型值。

原始目标连接ID（Original Destination Connection ID）：

:   原始目标连接ID包含了这个重试数据包正在响应的初始数据包中目标连接ID字段的值。这个字段的长度在原始目标连接ID长度字段中给出。这个字段的存在确保了合法的重试数据包只能由观测到初始数据包的实体构造出来。
