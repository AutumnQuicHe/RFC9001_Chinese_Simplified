---
title: "9.4. 对头部保护的分析"
anchor: "9.4_Header_Protection_Analysis"
weight: 940
rank: "h2"
---

《[NAN]()》分析了许多能保护随机数的认证加密算法，它们被称为“随机数隐藏”（HN）转换。本文档中的头部保护构建方法大体上可以算作是这些算法中的其中一种（HN1）。头部保护会在数据包保护AEAD之后被应用，它从AEAD的输出中采样一组字节样本（表达式中的`sample`），并以此方法使用伪随机函数（表达式中的`PRF`）来加密头部字段：

{{% block_ref
indx="Pseudocode_9_4_1" %}}

```
protected_field = field XOR PRF(hp_key, sample)
```

{{% /block_ref %}}

本文档中的头部保护的不同之处在于使用伪随机排列（PRP）来代替常规的PRF。然而，由于所有PRP都算作PRF（详见《[IMC]()》），所以这种修改并不违背HN1的构建原则。

由于`hp_key`与数据包保护密钥不同，因此头部保护能够达到《[NAN]()》中描述的AE2安全级别，从而保护数据包头部中的字段。将来的基于相同构建方式的头部保护变体{{< req_level MUST >}}使用PRF来确保获得一致的安全保障。

多次使用相同的密钥和密文样本会有使头部保护失效的风险。使用相同的密钥和密文样本来保护两份不同的包头会泄露受保护字段的异或结果。假设以AEAD作为PRF，如果采样了`L`个比特位，那么两份密文样本一致的概率约为<code>2<sup>-L/2</sup></code>，也就是所谓的生日攻击。对于在本文档中描述的算法，这个概率为<code>2<sup>64</sup></code>分之一。

为了防止被攻击者修改，数据包头部会受到数据包保护的认证；整个数据包头部都是受认证的额外数据的一部分。受保护的字段有没有被篡改只能在移除数据包保护后才被检测出来。
